---
title: "3.2. Branches and Tags mapping"
category: subchapter
booktype: remote
weight: 5
---
###3.2. Branches and Tags mapping

In this chapter we're going to look into various cases regarding branches and tags mapping that may occur during the work with the add-on.

For each project mapped to a Git repository, branches and tags are mapped to the corresponding references in the Git repository. SubGit distinguishes the following folders in Subversion project as branches or tags:

+ trunk folder
+ folders in the dedicated branches folder
+ folders in the dedicated shelves folder
+ folders in the dedicated tags folder

Shelves are special kind of branches used by SubGit to represent Git anonymous branches in Subversion repository.

Each folder is mapped to the reference (branch or tag) in the Git repository. For trunk folder the mapping is one-to-one as there could be only one trunk folder (as well as only one master reference in Git) and for other folders wildcard mapping is used. Default mapping and corresponding SubGit configuration file part is shown below.

**Case 1. Default Branches and Tags Mapping**

Let's say, at first, that we have a project with standart layout.

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    branches = branches/*:refs/heads/*
    tags = tags/*:refs/tags/*
    shelves = shelves/*:refs/shelves/*
    *

So having the branch **foo** translated we will get the same log message both at SVN and Git repository:

    [git]
    
    commit 04796
    Author: peatrovich
    
        delete files

    commit 2a7f3
    Author: peatrovich

        Updated database timeouts

    commit ce08b
    Author: peatrovich
    
        initial commit\

    [svn]

    r4 | peatrovich | 1 line

    delete files
    ------------------------------------------------------------------------
    r3 | peatrovich | 1 line

    Updated database timeouts
    ------------------------------------------------------------------------
    r2 | peatrovich | 2 lines

    initial commit\

Due to having tags mapping line in your configuration file, all tags you create in your Git repository would be copied to SVN repository.

    [git]

    $> git tag 1.1
    $> git push origin 1.1

    
    [svn]

    $> svn log -g https://subversion.assembla.com/svn/ktmate
    
    ------------------------------------------------------------------------
    r18 | peatrovich | 1 line

    Tag '/tags/1.1' created from /trunk:17

**Case 2. There is only trunk based in the root**

It's often the case, when there is no branches and project is based in the root of repository. It's possible to have the configuration file set this way:

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    *

Output of **svn log http://host/repo** command and **git log master** command should be the same:

    [git]

    $>git log master

    commit 04796
    Author: peatrovich

        delete files

    commit 2a7f3
    Author: peatrovich

        Updated database timeouts

    commit ce08be
    Author: peatrovich

        initial commit\

    [svn]

    $>svn log https://subversion.assembla.com/svn/ktmate/trunk

    r4 | peatrovich | 1 line

    delete files
    ------------------------------------------------------------------------
    r3 | peatrovich | 1 line

    Updated database timeouts
    ------------------------------------------------------------------------
    r2 | peatrovich | 2 lines

    initial commit\

Since there is no branch or shelves mapping, if you create a branch in your git repository, it will not be translated to SVN.
Consider this - the branch was created, file changed and change was commited:

    [git]

    $> git checkout -b bar
    
    Switched to a new branch 'bar'
    
    $> echo "substantial change of readme file" > README.rdoc 
    
    $> git commit -am "substantial change of readme”
    
    [bar 4d6a8] substantial change of readme
     1 file changed, 1 insertion(+), 1 deletions(-)

    $> git checkout master

    $> git merge bar

After that the branch was merged to master and changes translated to SVN.

This is what was changed in SVN repository:

    [svn]
    
    $> svn_ex katedrozdovsky$ svn log https://subversion.assembla.com/svn/ktmate

    ------------------------------------------------------------------------
    r20 | peatrovich | 1 line

    substantial change of readme

In other words, there is no reference to any branch ever existing, becuase there was no change in the master, thus, no merge process had actually taken place. The revision states only that file was changed.

Different thing happen, if after changing files in the branch, we also change something in master and then push it:

    [git]

    $> git merge bar
    
    Merge made by the 'recursive' strategy.
     README.rdoc | 1 +
     1 file changed, 1 insertion(+)
    
    $>  echo "important change" > Rakefile 
    
    $> git commit -am "important change"
    
    [master ad03078] important change
     1 file changed, 1 insertion(+), 1 deletion(-)
    
    $> git push origin

In this case following revisions will appear. The changes that were made in the branch, branch merge, and changes that were made in the master:

    [svn]

    $> svn log https://subversion.assembla.com/svn/ktmate
    
    ------------------------------------------------------------------------
    r25 | peatrovich | 1 line

    important change
    ------------------------------------------------------------------------
    r24 | peatrovich | 1 line

    Merge branch 'bar'
    ------------------------------------------------------------------------
    r23 | peatrovich | 1 line

    substantial change of readme

And the last example in this case. Create a new branch and change there something:

    [git]

    $> git checkout -b gar
    
    Switched to a new branch 'gar'
    
    $> echo "123" > README.rdoc
    
Then commit changes you've made and merge this branch to master, just as it was done before:

    [git]

    $> git commit -am "change in gar 3"
    
    [gar b738f32] change in gar 3
     1 file changed, 1 insertion(+), 1 deletion(-)
    
    $> git checkout master
    Switched to branch 'master'
    
    $> git merge gar

Then change something in master, commit it and push. Please note that this time not only master is being pushed, but the branch **gar** explicitly:

    [git]

    $> echo "test" > file.txt
    
    $> git commit -am "change in master 3"
    [master 623bf] change in master 3
     1 file changed, 1 insertion(+), 1 deletion(-)
    
    $> git push origin master

The result of that is as follows, new branch has been created in SVN repository:

    [svn]

    $> svn log https://subversion.assembla.com/svn/ktmate

    ------------------------------------------------------------------------
    r38 | peatrovich | 1 line

    Branch '/branches/gar' created from /trunk:36
    ------------------------------------------------------------------------
    r37 | peatrovich | 1 line

    change in master 3
    ------------------------------------------------------------------------
    r36 | peatrovich | 1 line

    change in gar 3

More details on this matter you will find in the chapter describing **Shelves**

**Case 3. Tricky names**

SubGit is working well with almost any layout. 

Whenever project uses standard folder names (i.e. trunk, branches and tags), SubGit would automatically detect and configure mapping for that project. Otherwise configuration would have to be manually adjusted to include proper paths and references names.

You can also use wildcard branches and tags mappings to define correspondence between set of Subversion directories that represent branches or tags and corresponding Git references.

Wildcard related mapping syntax rules:
+ Each mapping could include zero or more "\*" on both sides (sides are separated by ":") of the definition.
+ Each path or namespace segment should contain no more than one "\*".
+ Number of "\*" on the left side of the mapping must be equal to the number of "\*" on the right side of it.

Take for example a comlicated layout like this:

    *
    http://host/repo/trunk
    http://host/repo/release_X
    http://host/repo/release_Y
    http://host/repo/release_Z
    http://host/repo/fixbox/alex/bar
    http://host/repo/fixbox/alice/baz
    *

Configuration file would be looking like this in that case:

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    branches = release_*:refs/heads/release/*
    branches = fixbox/*/*:refs/heads/fixbox/*/*
    *

Please note, that to Git repository it will be translated as **release/X**, corresponding to the config file

    [git]

    $> git pull

    remote: Counting objects: 2, done.
    remote: Compressing objects: 100% (2/2), done.
    remote: Total 2 (delta 1), reused 0 (delta 0)
    Unpacking objects: 100% (2/2), done.
    From /Users/katedrozdovsky/Documents/Projects/tmate_ex/ktmate
    
     * [new branch]      fixbox/alex/bar -> origin/fixbox/alex/bar
     * [new branch]      release/X  -> origin/release/X

They are supposed to be used just as the any branch, except **release/X** branch translates to SVN as branch named **release_X**.

    [git]

    $> git checkout release/X
    
    $> echo "test" > file.txt 
    
    $> git commit -am "test release/X 1"
    
    [release/X f65b9] test release/X 1
     1 file changed, 1 insertion(+), 1 deletion(-)
    
    $> git push origin release/X


And of course it will appear in the log of corresponding SVN repository:

    [svn]

    $> svn log https://subversion.assembla.com/svn/ktmate/release_X
    ------------------------------------------------------------------------
    r55 | peatrovich | 1 line

    test release/X 1

If you create a new branch in git and name it e.g **release/AB**, like that:

    [git]

    $> git checkout -b release/AB
    
    Switched to a new branch 'release/AB'
    
    $> echo 'test new branch' > Rakefile 
    
    $> git commit -am "test new branch"
    
    [release/AB 405a9e5] test new branch
     1 file changed, 1 insertion(+), 1 deletion(-)
    
    $> git push origin release/AB

It will be translated to the SVN repository as branch named **release_AB**

    [svn]

    $> svn log https://subversion.assembla.com/svn/ktmate/release_AB
    
    ------------------------------------------------------------------------
    r56 | peatrovich | 1 line

    test new branch

**Case 4. Change layout already having the working mirror**

It is possible that at some point it would become nescessary to change layout config for the mirror that is already working.

Let's imagine, that there is a mirror with the default layout:

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    branches = branches/*:refs/heads/*
    tags = tags/*:refs/tags/*
    shelves = shelves/*:refs/shelves/*
    *

If it's changed by adding already existing (or existing ever before) in SVN repository branches 

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    branches = release_*:refs/heads/release/*
    *

and the command **subgit install** is ran, the installation will fail with following message:

    [subgit]

    $> subgit install .

    SubGit version 3.0.0 ('Bobique') build #3316

    About to shut down background translation process.
    Background translation process is not running.

    INSTALLATION FAILED

    error: Unable to activate configuration file '/Users/katedrozdovsky/Documents/Projects/tmate_ex/ktmate.git/subgit/config':
    error: The following new mappings have been removed from [svn] section:
    error:    release_*:refs/heads/release/*
    error:    fixbox/*/*:refs/heads/fixbox/*/*
    error: Only branches that are not yet present in Subversion history could be removed.
    error: Revert these deletions and run 'install' command, or force rebuild with '--rebuild' option.


In this case it's better to rename the branch in configuration file, as the **--rebuild** option is one extremely drastic measure.

If there was no such branch in SVN repository, it will be created, and you will be able to work with it as with a usual branch.

    [subgit]

    $> subgit install .

    SubGit version 3.0.0 ('Bobique') build #3316

    About to shut down background translation process.
    Background translation process is not running.

    Translating Subversion revisions to Git commits...

        Subversion revisions translated: 56.
        Total time: 90 seconds.

    INSTALLATION SUCCESSFUL

If there is a branch with the specific name space, that exists only in your Git repository, like that:

    [git]

    $> git checkout -b nice/branch
    
    Switched to a new branch 'nice/branch'
    
    $> echo "nice change" >> file.txt
    
    $> git commit -am "nice change"
    
    [nice/branch ad13e77] nice change
     1 file changed, 1 insertion(+)
    
    $> git push origin nice/branch


and you want to get it in the SVN repository, all you have to do is to add this namespace to your configuration file, for example, like this: 

    *
    url = https://subversion.assembla.com/svn/ktmate
    trunk = trunk:refs/heads/master
    branches = branches/nice/branch:refs/heads/nice/branch
    branches = branches/*:refs/heads/*
    *

and run **subgit install**. It will become available in your SVN repository after that:

    [svn]

    $> svn log https://subversion.assembla.com/svn/ktmate/branches/nice/branch
    
    ------------------------------------------------------------------------
    r57 | peatrovich | 1 line

    nice change

Congratulations! Now you are a Subgit branch expert.
[](#up)